/*
* vmLightbox() 1.4
*
* Copyright 2017
*
* By Dave Carney, https://vehiclemedia.com/
* Minimal image lightbox plugin
* works in all modern browsers including IE 11+
* 
* 	activate with:
* 		$(document).vmLightbox();
*
* 	or overide defaults with:
* 		$(document).vmLightbox({
*			selector: '.example-element a',
*			item_count: true
* 		});
*
*	Example markup:
*	<a href="PATH_TO_IMAGE" data-target="vm-lightbox" data-caption="SOME CAPTION HERE" data-group="EXAMPLE_GROUP_NAME">
*		<img src="PATH_TO_IMAGE_THUMB" alt="">
*	</a>
*
* 	watches for:
* 		data-target="vm-lightbox" 	(default: add this data-attribute to image links if you don't specify a selector)
* 		data-caption="some caption here"
* 		data-group="group-these-images-together"
*
* 	note: if you change the markup order for the caption or nav links,
* 		you will need to alter the "update" functions so they know where to place a previously non-existent element
*
*/

!function(b){b.fn.vmLightbox=function(o){var t='<svg id="vm-close-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 31.41 31.41"><line x1="0.71" y1="0.71" x2="0.71" y2="0.71" style="stroke-miterlimit:10"/><line x1="0.71" y1="0.71" x2="30.71" y2="30.71" style="stroke-miterlimit:10;"/><line x1="30.71" y1="0.71" x2="0.71" y2="30.71" style="stroke-miterlimit:10;"/></svg>',e='<svg id="vm-chevron-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34.62 66.41"><polyline points="33.91 0.71 1.41 33.21 33.91 65.71" style="stroke-miterlimit:10;"/></svg>',i='<svg id="vm-spinner" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 28.26"><circle cx="3.93" cy="14.88" r="3.93" style="fill:#fff"/><circle cx="7.39" cy="7.41" r="3.53" transform="translate(-3.07 6.52) rotate(-45)" style="fill:#fff;opacity:0.875"/><circle cx="15.73" cy="3.08" r="3.08" style="fill:#fff;opacity:0.75"/><circle cx="24.07" cy="7.41" r="2.64" transform="translate(1.81 18.32) rotate(-45)" style="fill:#fff;opacity:0.625"/><circle cx="27.53" cy="14.88" r="2.47" style="fill:#fff;opacity:0.5"/><circle cx="24.07" cy="24.09" r="1.98" transform="translate(-9.98 23.21) rotate(-45)" style="fill:#fff;opacity:0.375"/><circle cx="15.73" cy="26.67" r="1.58" style="fill:#fff;opacity:0.25"/><circle cx="7.39" cy="24.09" r="1.32" transform="translate(-14.87 11.41) rotate(-45)" style="fill:#fff;opacity:0.125"/></svg>';function r(t){var e=b(t).index(o.selector),i={href:b(t).attr("href"),caption:b(t).data("caption"),prev_index:e-1,next_index:e+1,prev_href:b(document).find(o.selector).eq(e-1).attr("href"),next_href:b(document).find(o.selector).eq(e+1).attr("href"),total_items:b(document).find(o.selector).length};function n(){return i}return n}o=b.extend({selector:'a[data-target="vm-lightbox"]',prev_link_class:"prev-nav",prev_link_text:'<span class="vm-chevron-left">'+e+"</span>",next_link_class:"next-nav",next_link_text:'<span class="vm-chevron-right">'+e+"</span>",single:!1,item_count:!1,close_text:t+'<span class="sr-only">Close Lightbox</span>',spinner:i},o),b('*[data-group=""]').removeAttr("data-group"),b('*[data-caption=""]').removeAttr("data-caption");var n=!1;if(0<b("*[data-group]").length){n=!0;var l=o.selector}function c(){return'<div class="vm-loading">'+o.spinner+"</div>"}function a(t){return 1<t.total_items?'<p class="vm-lightbox-image-count"><span>'+t.next_index+"</span> of "+t.total_items+"</p>":""}function s(t){return void 0!==t?v(t):""}function v(t){return'<p class="vm-lightbox-caption">'+t+"</p>"}function f(t){return 0<=t.prev_index?x(o.prev_link_class,t.prev_href,o.prev_link_text):""}function m(t){return void 0!==t.next_href?x(o.next_link_class,t.next_href,o.next_link_text):""}function x(t,e,i){return'<a class="vm-lightbox-nav '+t+'" href="'+e+'">'+i+"</a>"}function g(){var t=b(".vm-lightbox-container").outerHeight()-b(".vm-lightbox-container").height(),e=b("#vm-lightbox").height()-b(".vm-lightbox-info").outerHeight()-t;function i(){b(".vm-lightbox-img").css("max-height",e)}i()}function h(t){g();var e=new Image;e.onload=function(){b(".vm-loading").fadeOut(250,function(){b(".vm-lightbox-container").css("background",""),b(".vm-lightbox-img").animate({opacity:1},400)})},e.src=t,b(".vm-lightbox-img").attr("src",e.src)}function p(t){var e=b(".vm-lightbox-caption");if(void 0===t.caption)return e.remove(),"";0<e.length?e.text(t.caption):b(".vm-lightbox-info").append(s(t.caption))}function u(t){var e=b("."+o.prev_link_class),i=b("."+o.next_link_class);0<=t.prev_index?0<e.length?e.attr("href",t.prev_href):i.before(x(o.prev_link_class,t.prev_href,o.prev_link_text)):e.remove()}function d(t){var e=b("."+o.prev_link_class),i=b("."+o.next_link_class);void 0===t.next_href?i.remove():0<i.length?i.attr("href",t.next_href):e.after(x(o.next_link_class,t.next_href,o.next_link_text))}function _(t){function e(){h(t.href)}return b(".vm-lightbox-image-count span").text(t.next_index),u(t),d(t),p(t),e()}b(window).resize(function(){clearTimeout(b.data(this,"resizeTimer")),b.data(this,"resizeTimer",setTimeout(g,500))}),b(document).on("click",o.selector,function(t){t.preventDefault(),b("body").append(c()),n&&(b(this).data("group")?o.selector+='[data-group="'+b(this).data("group")+'"]':o.selector+=":not([data-group])");var e=r(this);if(0===b("#vm-lightbox").length){var i='<div id="vm-lightbox" style="opacity: 0;"><div class="vm-lightbox-container" style="background: none;"><div class="vm-lightbox-img-container"><a class="vm-lightbox-close" title="Close">'+o.close_text+'</a><img class="vm-lightbox-img" src="" style="opacity: 0;"></div> \x3c!-- .vm-lightbox-img-container --\x3e<div class="vm-lightbox-info">';o.item_count&&(i+=a(e())),o.single||(i+=f(e())+m(e())),i+=s(e().caption),b(i+="</div> \x3c!-- .vm-lightbox-info --\x3e</div></div>").appendTo("body").fadeTo(250,1,h(e().href))}}),b(document).on("click touchend onpointerup","a.vm-lightbox-nav",function(t){t.preventDefault(),b(".vm-lightbox-container").css("background","none"),b(".vm-lightbox-img").css("opacity","0"),b(".vm-loading").show();var e=b(this).attr("href"),i,n;_(r(b(document).find(o.selector+'[href="'+e+'"]'))())}),b(document).on("click",".vm-lightbox-close",function(){b("#vm-lightbox").fadeOut(250,function(){b(".vm-lightbox-img").attr("src",""),b("#vm-lightbox, .vm-loading").remove()}),n&&(o.selector=l)}),b(document).on("click touchend onpointerup","#vm-lightbox",function(t){var e;t.preventDefault(),0<=["vm-lightbox-img","vm-lightbox-image-count","vm-lightbox-caption"].indexOf(b(t.target).attr("class"))||b(t.target).closest("a.vm-lightbox-nav").is(".vm-lightbox-nav")||(b("#vm-lightbox").fadeOut(250,function(){b("#vm-lightbox, .vm-loading").remove()}),n&&(o.selector=l))})}}(jQuery);